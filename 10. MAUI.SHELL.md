# .NET MAUI SHELL

En **.NET MAUI**, `Shell` es una forma de estructurar la navegaci√≥n y la jerarqu√≠a de la aplicaci√≥n. Proporciona una manera sencilla de definir la estructura de la aplicaci√≥n, incluyendo men√∫s desplegables (Flyout), pesta√±as (Tabs), y la navegaci√≥n entre p√°ginas. Shell simplifica la creaci√≥n de aplicaciones con una estructura de navegaci√≥n compleja, como aplicaciones con men√∫s laterales, pesta√±as inferiores, y m√°s.

‚úÖ Flyout Navigation (Men√∫ lateral)

‚úÖ Tabs (Pesta√±as inferiores o internas en una secci√≥n)

‚úÖ Navegaci√≥n jer√°rquica

**Shell** nos ayuda a simplificar la navegaci√≥n sin necesidad de definir NavigationPage o MasterDetailPage manualmente.

## Jerarqu√≠a de .NET MAUI Shell

La estructura de Shell sigue una jerarqu√≠a espec√≠fica:
* Flyout (Opcional): Un men√∫ lateral con opciones.
  * FlyoutItem: Un √≠tem dentro del men√∫ lateral.
    * TabBar (Opcional): Grupo de pesta√±as dentro del FlyoutItem.
      * Tab: Una pesta√±a dentro de una TabBar.
        * ShellContent: La p√°gina que se muestra.

```xml
<Shell>
    <FlyoutItem Title="Main Section">
        <ShellContent Title="Home" ContentTemplate="{DataTemplate views:HomePage}" />
        <ShellContent Title="Settings" ContentTemplate="{DataTemplate views:SettingsPage}" />
    </FlyoutItem>
</Shell>
```

Aqu√≠, tenemos un FlyoutItem con dos p√°ginas: Home y Settings.

## 1. Creando un AppShell en .NET MAUI

Para crear una aplicaci√≥n con Shell en .NET MAUI, sigue estos pasos:

### 1. Crear el AppShell.xaml

Este archivo define la estructura de navegaci√≥n de la aplicaci√≥n.

```xml
<Shell xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
       xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
       xmlns:views="clr-namespace:MyApp.Views"
       x:Class="MyApp.AppShell">

    <!-- Flyout Header -->
    <Shell.FlyoutHeader>
        <Grid BackgroundColor="Black" HeightRequest="150">
            <Image Source="header.jpg" Aspect="AspectFill" Opacity=".5"/>
            <Label Text="My App" TextColor="White" FontSize="Large" HorizontalOptions="Center"/>
        </Grid>
    </Shell.FlyoutHeader>

    <!-- Flyout Item -->
    <FlyoutItem Title="Dashboard">
        <ShellContent Title="Home" ContentTemplate="{DataTemplate views:HomePage}" />
        <ShellContent Title="Settings" ContentTemplate="{DataTemplate views:SettingsPage}" />
    </FlyoutItem>

    <!-- Otra secci√≥n con Tabs -->
    <FlyoutItem Title="Explore">
        <Tab Title="Destinations">
            <ShellContent Title="Cities" ContentTemplate="{DataTemplate views:CitiesPage}" />
            <ShellContent Title="Parks" ContentTemplate="{DataTemplate views:ParksPage}" />
        </Tab>
        <Tab Title="Nature">
            <ShellContent Title="Mountains" ContentTemplate="{DataTemplate views:MountainsPage}" />
            <ShellContent Title="Lakes" ContentTemplate="{DataTemplate views:LakesPage}" />
        </Tab>
    </FlyoutItem>

    <!-- Flyout Items -->
    <FlyoutItem Title="Desert Mirage">
        <FlyoutItem.Icon>
            <FontImageSource FontFamily="Icons" Color="Black" Glyph="{x:Static utilities:IconFont.DesertMirage}" />
        </FlyoutItem.Icon>
        <ShellContent Title="Night Dune Buggy" ContentTemplate="{DataTemplate nightPagesNameSpace:StartGazingPages}">
            <ShellContent.Icon>
                <FontImageSource FontFamily="Icons" Color="Black" Glyph="{x:Static utilities:IconFont.Night_dune_buggy}" />
            </ShellContent.Icon>
        </ShellContent>
    </FlyoutItem>

    <!-- M√°s FlyoutItems y ShellContent aqu√≠ -->

</Shell>
```

‚úÖ Explicaci√≥n r√°pida:

* FlyoutItem: Crea una opci√≥n en el men√∫ lateral.
* ShellContent: Representa una p√°gina dentro de un FlyoutItem.
* Tab: Agrupa p√°ginas en pesta√±as cuando hay m√°s de un ShellContent.

### 2. Registrando P√°ginas con AddTransient en MauiProgram.cs

.NET MAUI usa inyecci√≥n de dependencias para manejar la navegaci√≥n entre p√°ginas.
Debemos registrar nuestras p√°ginas en MauiProgram.cs:

```csharp
public static class MauiProgram
{
    public static MauiApp CreateMauiApp()
    {
        var builder = MauiApp.CreateBuilder();
        builder
            .UseMauiApp<App>()
            .ConfigureFonts(fonts => {
                fonts.AddFont("OpenSans-Regular.ttf", "OpenSansRegular");
            });

        // Registro de p√°ginas para inyecci√≥n de dependencias
        builder.Services.AddTransient<HomePage>();
        builder.Services.AddTransient<SettingsPage>();
        builder.Services.AddTransient<CitiesPage>();
        builder.Services.AddTransient<ParksPage>();
        builder.Services.AddTransient<MountainsPage>();
        builder.Services.AddTransient<LakesPage>();

        return builder.Build();
    }
}
```

‚úÖ ¬øPor qu√© usamos AddTransient?

Cada vez que se navega a una p√°gina, se crea una nueva instancia.

### 3. Inyeccion de Dependencias y viewmodel

Si est√°s utilizando ViewModels, puedes registrarlos en el contenedor de dependencias y luego inyectarlos en tus p√°ginas.

```csharp
public class StartGazingPages : ContentPage
{
    public StartGazingPages(StartGazingViewModel viewModel)
    {
        BindingContext = viewModel;
        // Configuraci√≥n de la p√°gina
    }
}
```

En `MauiProgram`:

```csharp
builder.Services.AddTransient<StartGazingViewModel>();
```

### 4. Inyecci√≥n de IServiceProvider en AppShell

Para que `AppShell` reciba las p√°ginas inyectadas, modificamos `App.xaml.cs`:

```csharp
public App(IServiceProvider serviceProvider)
{
    InitializeComponent();
    MainPage = serviceProvider.GetRequiredService<AppShell>();
}
```
üìå Explicaci√≥n:

* IServiceProvider obtiene instancias de AppShell y las p√°ginas registradas.

### 5. Agregar un FlyoutItem

Un FlyoutItem es un elemento en el men√∫ lateral que puede contener una o m√°s p√°ginas. Aqu√≠ te muestro c√≥mo agregar un FlyoutItem con varias p√°ginas:

```xml
<FlyoutItem Title="Desert Mirage">
    <FlyoutItem.Icon>
        <FontImageSource FontFamily="Icons" Color="Black" Glyph="{x:Static utilities:IconFont.DesertMirage}" />
    </FlyoutItem.Icon>
    <ShellContent Title="Night Dune Buggy" ContentTemplate="{DataTemplate nightPagesNameSpace:StartGazingPages}">
        <ShellContent.Icon>
            <FontImageSource FontFamily="Icons" Color="Black" Glyph="{x:Static utilities:IconFont.Night_dune_buggy}" />
        </ShellContent.Icon>
    </ShellContent>
    <ShellContent Title="Other Page" ContentTemplate="{DataTemplate nightPagesNameSpace:OtherPage}">
        <ShellContent.Icon>
            <FontImageSource FontFamily="Icons" Color="Black" Glyph="{x:Static utilities:IconFont.OtherIcon}" />
        </ShellContent.Icon>
    </ShellContent>
</FlyoutItem>
```
**Agregar √çconos a los FlyoutItems**

Para agregar √≠conos usamos FontImageSource:
```xml
<FlyoutItem Title="Dashboard">
    <FlyoutItem.Icon>
        <FontImageSource FontFamily="Icons" Glyph="{x:Static resources:IconFont.Dashboard}" />
    </FlyoutItem.Icon>
    <ShellContent Title="Home" ContentTemplate="{DataTemplate views:HomePage}" />
</FlyoutItem>
```
* `FontImageSource` permite usar fuentes personalizadas para √≠conos.
* `Glyph="{x:Static resources:IconFont.Dashboard}"` representa un icono en la fuente.

### 6. Agregar Tabs dentro de un FlyoutItem

Si deseas agregar pesta√±as dentro de un FlyoutItem, puedes usar el elemento Tab:
```xml
<FlyoutItem Title="Desert Mirage">
    <FlyoutItem.Icon>
        <FontImageSource FontFamily="Icons" Color="Black" Glyph="{x:Static utilities:IconFont.DesertMirage}" />
    </FlyoutItem.Icon>
    <Tab Title="Night Adventures">
        <Tab.Icon>
            <FontImageSource FontFamily="Icons" Color="Black" Glyph="{x:Static utilities:IconFont.Night_dune_buggy}" />
        </Tab.Icon>
        <ShellContent Title="Night Dune Buggy" ContentTemplate="{DataTemplate nightPagesNameSpace:StartGazingPages}">
            <ShellContent.Icon>
                <FontImageSource FontFamily="Icons" Color="Black" Glyph="{x:Static utilities:IconFont.Night_dune_buggy}" />
            </ShellContent.Icon>
        </ShellContent>
        <ShellContent Title="Other Page" ContentTemplate="{DataTemplate nightPagesNameSpace:OtherPage}">
            <ShellContent.Icon>
                <FontImageSource FontFamily="Icons" Color="Black" Glyph="{x:Static utilities:IconFont.OtherIcon}" />
            </ShellContent.Icon>
        </ShellContent>
    </Tab>
</FlyoutItem>
```
### 7. Personalizar Flyout (Header, Footer, Color, Imagen)

Podemos personalizar el Flyout con:

üìå Cambiar color de fondo y tama√±o
```xml
<Shell FlyoutWidth="400"
       FlyoutHeight="500"
       FlyoutBackgroundColor="AliceBlue"
       FlyoutBackgroundImage="background.jpg"
       FlyoutBackdrop="Gray">
</Shell>
```
üìå Agregar Header y Footer

Puedes personalizar el icono, el encabezado (header), y el pie de p√°gina (footer) del Flyout:

```xml
<Shell.FlyoutIcon>
    <FontImageSource FontFamily="Icons" Glyph="{x:Static utilities:IconFont.Logo}" Color="Black" />
</Shell.FlyoutIcon>

<Shell.FlyoutHeader>
    <Grid BackgroundColor="Black" HeightRequest="150">
        <Image Source="park.jpg" Aspect="AspectFill" Opacity=".5" />
        <Label FontFamily="KanitB" FontSize="Large" HorizontalOptions="Center" Text="Devs Park" TextColor="White" />
    </Grid>
</Shell.FlyoutHeader>

<Shell.FlyoutFooter>
    <Grid Padding="15" BackgroundColor="Gray" HeightRequest="100" RowDefinitions="*,*">
        <Label FontAttributes="Bold" HorizontalOptions="Center" Text="Powered by:" TextColor="White" />
        <Label Grid.Row="1" FontAttributes="Bold" HorizontalOptions="Center" Text=".NET MAUI" TextColor="White" />
    </Grid>
</Shell.FlyoutFooter>
```

**Comportamiento y Apariencia del Flyout**

Puedes controlar c√≥mo se muestra el Flyout con las siguientes propiedades:

* FlyoutDisplayOptions: AsSingleItem o AsMultipleItems.
* FlyoutBehavior: Disabled, Locked, o Flyout.
* FlyoutVerticalScrollMode: Controla el desplazamiento vertical.
* FlyoutHeaderBehavior: CollapseOnScroll, Default, Fixed, o Scroll.

```xml
<FlyoutItem Title="Desert Mirage" FlyoutDisplayOptions="AsSingleItem">
    <!-- Contenido del FlyoutItem -->
</FlyoutItem>
```

**Personalizaci√≥n de los FlyoutItems**

Puedes personalizar la apariencia de los FlyoutItem usando un ItemTemplate:

```xml
<Shell.ItemTemplate>
    <DataTemplate>
        <Grid>
            <VisualStateManager.VisualStateGroups>
                <VisualStateGroup x:Name="CommonStates">
                    <VisualState x:Name="Normal">
                        <VisualState.Setters>
                            <Setter TargetName="background" Property="Rectangle.Fill" Value="White" />
                        </VisualState.Setters>
                    </VisualState>
                    <VisualState x:Name="Selected">
                        <VisualState.Setters>
                            <Setter TargetName="background" Property="Rectangle.Fill" Value="Black" />
                        </VisualState.Setters>
                    </VisualState>
                </VisualStateGroup>
            </VisualStateManager.VisualStateGroups>
            <Image Margin="5" HeightRequest="45" Source="{Binding FlyoutIcon}" />
            <Label Text="{Binding Title}" TextColor="White" />
            <Rectangle x:Name="background" Fill="White" Opacity=".1" />
        </Grid>
    </DataTemplate>
</Shell.ItemTemplate>
```

### 8. Agregar MenuItem al Flyout

Los MenuItem son elementos que aparecen en el men√∫ lateral y pueden tener interactividad. Para elementos extras en el men√∫ como "Ayuda" o "Salir":
```xml
<MenuItem Text="Help" Command="{Binding HelpCommand}">
    <MenuItem.IconImageSource>
        <FontImageSource FontFamily="Icons" Glyph="{x:Static utilities:IconFont.Help}" />
    </MenuItem.IconImageSource>
</MenuItem>
```

### 8. Controlar el Flyout desde C√≥digo

Puedes controlar el Flyout mediante comandos en tu ViewModel:
```csharp
[RelayCommand]
public async Task OpenFlyout()
{
    Shell.Current.FlyoutIsPresented = true;
}
```

## Creando un Shell Solo con Pesta√±as en .NET MAUI

En .NET MAUI, puedes crear una aplicaci√≥n que solo tenga pesta√±as inferiores (sin un men√∫ lateral o Flyout) utilizando el elemento `<TabBar>`. Este enfoque es √∫til para aplicaciones que no requieren un men√∫ lateral y prefieren una navegaci√≥n basada en pesta√±as.

**Ejemplo b√°sico de Shell con Pesta√±as (TabBar)**
```xml
<Shell xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
       xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
       xmlns:local="clr-namespace:YourNamespace"
       x:Class="YourNamespace.AppShell">

    <!-- TabBar para pesta√±as inferiores -->
    <TabBar>
        <!-- Primera pesta√±a -->
        <Tab Title="Home" Icon="home.png">
            <ShellContent ContentTemplate="{DataTemplate local:HomePage}" />
        </Tab>

        <!-- Segunda pesta√±a -->
        <Tab Title="Profile" Icon="profile.png">
            <ShellContent ContentTemplate="{DataTemplate local:ProfilePage}" />
        </Tab>

        <!-- Tercera pesta√±a -->
        <Tab Title="Settings" Icon="settings.png">
            <ShellContent ContentTemplate="{DataTemplate local:SettingsPage}" />
        </Tab>
    </TabBar>

</Shell>
```

* `<TabBar>`: Contenedor principal para las pesta√±as inferiores.
* `<Tab>`: Representa una pesta√±a individual. Cada pesta√±a tiene un t√≠tulo (Title) y un icono (Icon).
* `<ShellContent>`: Define el contenido de la pesta√±a, que es una p√°gina espec√≠fica (ContentTemplate).

### Personalizando Pesta√±as (TabBar)

Podemos modificar los estilos de la barra de pesta√±as agregando `Setters` dentro de `Shell.Resources`:

```xml
<Shell.Resources>
    <Style TargetType="TabBar">
        <!-- Color de fondo de la barra de pesta√±as -->
        <Setter Property="Shell.TabBarBackgroundColor" Value="#1D1F24" />

        <!-- Color de los elementos deshabilitados en la barra de pesta√±as -->
        <Setter Property="Shell.TabBarDisableColor" Value="#1D1F24" />

        <!-- Color del texto y los iconos en la barra de pesta√±as -->
        <Setter Property="Shell.TabBarForegroundColor" Value="#FFFFFF" />

        <!-- Color del t√≠tulo de la pesta√±a seleccionada -->
        <Setter Property="Shell.TabBarTitleColor" Value="#C900EA" />

        <!-- Color del texto y los iconos de las pesta√±as no seleccionadas -->
        <Setter Property="Shell.TabBarUnselectedColor" Value="#929292" />
    </Style>
</Shell.Resources>
```
Explicaci√≥n de las propiedades:
* `Shell.TabBarBackgroundColor`: Define el color de fondo de la barra de pesta√±as.
* `Shell.TabBarDisableColor`: Define el color de los elementos deshabilitados en la barra de pesta√±as.
* `Shell.TabBarForegroundColor`: Define el color del texto y los iconos en la barra de pesta√±as.
* `Shell.TabBarTitleColor`: Define el color del t√≠tulo de la pesta√±a seleccionada.
* `Shell.TabBarUnselectedColor`: Define el color del texto y los iconos de las pesta√±as no seleccionadas.

### Aplicando Estilos al Flyout desde Styles.xaml

Puedes aplicar los mismos estilos al Flyout (men√∫ lateral) utilizando un estilo global en `Styles.xaml`:

```xml
<Style ApplyToDerivedTypes="True" TargetType="Shell">
    <Setter Property="Shell.TabBarBackgroundColor" Value="#1D1F24" />
    <Setter Property="Shell.TabBarDisableColor" Value="#1D1F24" />
    <Setter Property="Shell.TabBarForegroundColor" Value="#FFFFFF" />
    <Setter Property="Shell.TabBarTitleColor" Value="#C900EA" />
    <Setter Property="Shell.TabBarUnselectedColor" Value="#929292" />
</Style>
```

### Control de Visibilidad del TabBar y NavBar

Puedes ocultar la barra de pesta√±as (TabBar) en una p√°gina espec√≠fica usando las siguientes propiedades:

**1. Ocultar la barra de pesta√±as en una p√°gina:**
```xml
<ShellContent Title="Frozen Drinks" Shell.TabBarIsVisible="False" ContentTemplate="{DataTemplate local:FrozenDrinksPage}" />
```
**2. Ocultar una pesta√±a espec√≠fica:**
```xml
<ShellContent Title="Frozen Drinks" IsVisible="False" ContentTemplate="{DataTemplate local:FrozenDrinksPage}" />
```
**3.  Para ocultar la barra de pesta√±as (TabBar):**
```xml
<ShellContent Shell.TabBarIsVisible="False"
              ContentTemplate="{DataTemplate local:HiddenPage}" />
```
**4.  Para ocultar la barra de navegaci√≥n (NavBar):**
```xml
<ShellContent Shell.NavBarIsVisible="False"
              ContentTemplate="{DataTemplate local:HiddenPage}" />
```
**5.  Para ocultarlas desde ContentPage:**
```xml
<ContentPage Shell.NavBarIsVisible="False"
             Shell.TabBarIsVisible="False">
</ContentPage>
```

### Personalizaci√≥n de colores en Shell

Puedes personalizar los colores globales de la aplicaci√≥n directamente en el archivo AppShell.xaml

```xml
<Shell
    BackgroundColor="#1D1F24" <!-- Color de fondo del Shell -->
    ForegroundColor="#C900EA" <!-- Color del texto y los iconos -->
    TitleColor="#ECE7FF" <!-- Color del t√≠tulo -->
    UnselectedColor="#545454"> <!-- Color de los elementos no seleccionados -->
</Shell>
```
### Ocultar la barra de navegaci√≥n

Puedes ocultar la barra de navegaci√≥n (donde est√° el t√≠tulo y el men√∫ de hamburguesa) en una p√°gina espec√≠fica:

1. Desde ShellContent:
```xml
<ShellContent Shell.NavBarIsVisible="False" ContentTemplate="{DataTemplate local:SomePage}" />
```
2. Desde ContentPage:
```xml
<ContentPage
    Shell.NavBarIsVisible="False"
    Shell.TabBarIsVisible="False">
</ContentPage>
```

### Personalizando la Barra de Navegacion

Podemos personalizar la barra de navegaci√≥n (TitleView) en el Shell:

```xml
<Shell>
    <Shell.TitleView>
        <Grid ColumnDefinitions="*, Auto">
            <Image HorizontalOptions="Start"
                   Source="logo.png"
                   VerticalOptions="Center" />
            <Label Grid.Column="1"
                   FontFamily="Icons"
                   Text="{x:Static utilities:IconFont.Search}"
                   TextColor="White"
                   HorizontalOptions="End"
                   VerticalOptions="Center" />
        </Grid>
    </Shell.TitleView>
</Shell>
```
* `Shell.TitleView` ‚Üí Personaliza la barra de navegaci√≥n.
* `Grid ColumnDefinitions="*, Auto"` ‚Üí Distribuye el contenido en dos columnas.
* `Image` ‚Üí Agrega un logo en la barra de navegaci√≥n.
* `Label` ‚Üí Agrega un icono de b√∫squeda en la esquina derecha.

## Navegacion en .NET MAUI con Shell

En .NET MAUI, la navegaci√≥n es una parte fundamental para moverte entre las diferentes p√°ginas de tu aplicaci√≥n. Shell proporciona una forma sencilla y poderosa de manejar la navegaci√≥n, incluyendo rutas absolutas, rutas relativas, y el paso de informaci√≥n entre p√°ginas. A continuaci√≥n, te explico todo esto en detalle.

### Eventos de navegacion

El AppShell en .NET MAUI hereda de Shell, lo que nos da acceso a dos eventos clave para manejar la navegaci√≥n:

* `OnNavigated`: Se ejecuta cuando la navegaci√≥n ha concluido correctamente.
* `OnNavigating`: Se ejecuta durante la transici√≥n de navegaci√≥n, antes de que la nueva p√°gina se muestre.

#### üìç Cuando concluye la navegaci√≥n (OnNavigated)

```csharp
protected override void OnNavigated(ShellNavigatedEventArgs args)
{
    base.OnNavigated(args);
    Debug.WriteLine($"--- Navegaci√≥n realizada: {args.Source} de {args.Previous?.Location} a {args.Current?.Location}");
}
```

* Se ejecuta cuando la navegaci√≥n finaliza correctamente.
* `args.Source`: Indica c√≥mo se inici√≥ la navegaci√≥n (por c√≥digo, usuario, etc.).
* `args.Previous?.Location`: Ruta de la p√°gina anterior.
* `args.Current?.Location`: Ruta de la p√°gina actual.

#### üìç Cuando se inicia la navegaci√≥n (OnNavigating)

```csharp
protected override void OnNavigating(ShellNavigatingEventArgs args)
{
    base.OnNavigating(args);
}
```
* Se dispara antes de que la navegaci√≥n ocurra.
* Se puede usar para validar o cancelar la navegaci√≥n

Ejemplo final:
```csharp
public partial class AppShell : Shell
{
    public AppShell()
    {
        InitializeComponent();
    }

    // Evento cuando la navegaci√≥n ha concluido
    protected override void OnNavigated(ShellNavigatedEventArgs args)
    {
        base.OnNavigated(args);

        Debug.WriteLine($"--- A navigation was performed: {args.Source} from {args.Previous?.Location} to {args.Current?.Location}");
    }

    // Evento durante la transici√≥n de navegaci√≥n
    protected override void OnNavigating(ShellNavigatingEventArgs args)
    {
        base.OnNavigating(args);

        Debug.WriteLine($"--- Navigating from {args.Current?.Location} to {args.Target?.Location}");
    }
}
```
* **ShellNavigatedEventArgs**: Proporciona informaci√≥n sobre la navegaci√≥n completada, como la ubicaci√≥n anterior (Previous) y la actual (Current).
* **ShellNavigatingEventArgs**: Proporciona informaci√≥n sobre la navegaci√≥n en curso, como la ubicaci√≥n actual (Current) y la de destino (Target).

### Definici√≥n de Rutas en Shell

Para evitar que las rutas aparezcan como //D_FAULT_ShellContent2, puedes definir rutas personalizadas para FlyoutItem, Tab, y ShellContent.

```xml
<FlyoutItem Title="Desert Mirage" Route="desertMirage">
    <Tab Title="Night Adventures" Route="nightAdventure">
        <ShellContent Title="Night Dune Buggy" Route="nightDune" ContentTemplate="{DataTemplate local:NightDunePage}" />
    </Tab>
</FlyoutItem>
```
Resultado:

Cuando navegues a esta p√°gina, el Debug.WriteLine mostrar√° algo como:
```
--- A navigation was performed: ShellItemChange from //desertMirage/nightAdventure/nightDune
```

### Navegaci√≥n entre p√°ginas

#### 1. Rutas Absolutas

Las rutas absolutas comienzan con `//` y te permiten navegar directamente a una p√°gina espec√≠fica.

```csharp
[RelayCommand]
public async Task ShowOffersCommand()
{
    await Shell.Current.GoToAsync("//tropicalParadise/jungleAdventures/zipLines");
    Shell.Current.FlyoutIsPresented = false; // Cierra el Flyout despu√©s de la navegaci√≥n
}
```

#### 2. Rutas Globales

Para navegar a p√°ginas que no est√°n en la jerarqu√≠a de Shell, debes registrar rutas globales en `App.xaml.cs`.

```csharp
public App(IServiceProvider serviceProvider)
{
    InitializeComponent();
    RegisterRoutes();
    MainPage = serviceProvider.GetRequiredService<AppShell>();
}

private void RegisterRoutes()
{
    Routing.RegisterRoute("featuredView", typeof(FeaturedView));
    Routing.RegisterRoute("offersView", typeof(OffersView));
}
```
Uso de rutas globales:
```csharp
[RelayCommand]
public async Task ShowOffersCommand()
{
    await Shell.Current.GoToAsync("featuredView"); // Navega a la p√°gina registrada
    await Shell.Current.GoToAsync(".."); // Regresa a la p√°gina anterior
    Shell.Current.FlyoutIsPresented = false;
}
```
#### 3. Rutas Contextuales

Permiten navegar a p√°ginas basadas en la p√°gina actual.

```csharp
private void RegisterRoutes()
{
    Routing.RegisterRoute("iceCream/details", typeof(IceCreamDetailsPage));
}
```

Uso de rutas contextuales:
```csharp
[RelayCommand]
public async Task ShowDetailsCommand()
{
    await Shell.Current.GoToAsync("//iceCream"); // Navega a la p√°gina principal
    await Shell.Current.GoToAsync("details"); // Navega a la p√°gina de detalles
}
```

### Paso de Informaci√≥n entre P√°ginas

Puedes pasar informaci√≥n entre p√°ginas usando Query Parameters.

**1. Uso de Query Parameters:**

```csharp
[RelayCommand]
public async Task SelectionChanged()
{
    await Shell.Current.GoToAsync($"offersView?name={selectedItem.BusinessName}");
}
```
En el ViewModel de la p√°gina de destino:
```csharp
[QueryProperty(nameof(CompanyName), "name")]
public partial class OffersViewModel : ObservableObject
{
    [ObservableProperty]
    string companyName = "Company Name";
}
```

**2. Uso de IQueryAttributable:**

Si necesitas manejar m√∫ltiples par√°metros o l√≥gica m√°s compleja, implementa la interfaz IQueryAttributable.

```csharp
public partial class OffersViewModel : ObservableObject, IQueryAttributable
{
    [ObservableProperty]
    string companyName = "Company Name";

    public void ApplyQueryAttributes(IDictionary<string, object> query)
    {
        if (query.ContainsKey("id"))
        {
            var companyId = query["id"];
            Offers = new ObservableCollection<Offer>(offerService.GetOffers(int.Parse(companyId.ToString())));
        }
    }
}
```
Uso:
```csharp
[RelayCommand]
public async Task ShowOffersCommand()
{
    await Shell.Current.GoToAsync($"offersView?id={selectedItem.Id}");
}
```

### Hblando m√°s sobre navegaci√≥n en .Net MAUI 

En .NET MAUI, cuando trabajamos con navegaci√≥n en una aplicaci√≥n basada en Shell, el bot√≥n "Atr√°s" se genera autom√°ticamente en la parte superior cuando navegamos entre p√°ginas. Sin embargo, podemos personalizar tanto su √≠cono como su funcionalidad.

#### Personalizar el bot√≥n "Atr√°s" en .NET MAUI

Podemos modificar tanto la apariencia como el comportamiento del bot√≥n "Atr√°s" usando `Shell.BackButtonBehavior` en una `ContentPage`.

**Ejemplo de personalizaci√≥n del √≠cono y comportamiento del bot√≥n "Atr√°s":**
```xml
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:utilities="clr-namespace:MiApp.Utilities"
             x:Class="MiApp.Views.MiPagina">
    
    <Shell.BackButtonBehavior>
        <BackButtonBehavior Command="{Binding BackCommand}">
            <!-- Cambiamos el icono del bot√≥n "Atr√°s" -->
            <BackButtonBehavior.IconOverride>
                <FontImageSource
                    FontFamily="Icons"
                    Glyph="{x:Static utilities:IconFont.Back}"
                    Color="{StaticResource IconColor}" />
            </BackButtonBehavior.IconOverride>
        </BackButtonBehavior>
    </Shell.BackButtonBehavior>

</ContentPage>
```

* `Shell.BackButtonBehavior`: Define el comportamiento del bot√≥n "Atr√°s".
* `BackButtonBehavior.Command`: Asigna un comando personalizado para ejecutar una acci√≥n cuando se presiona el bot√≥n.
* `BackButtonBehavior.IconOverride`: Permite sobreescribir el √≠cono predeterminado del bot√≥n "Atr√°s" con uno personalizado.
  * En este caso, usamos un `FontImageSource` con una fuente de √≠conos personalizada.

#### Definir el comando en el ViewModel

En el ViewModel, debemos definir el comando que manejar√° la acci√≥n al presionar el bot√≥n "Atr√°s":

```csharp
using System.Windows.Input;
using Microsoft.Maui.Controls;
using System.Threading.Tasks;

public class MiPaginaViewModel
{
    public ICommand BackCommand { get; }

    public MiPaginaViewModel()
    {
        BackCommand = new Command(async () => await VolverAtras());
    }

    private async Task VolverAtras()
    {
        // Aqu√≠ puedes agregar l√≥gica personalizada antes de regresar
        bool confirmar = await App.Current.MainPage.DisplayAlert(
            "Confirmar", "¬øDeseas regresar?", "S√≠", "No");

        if (confirmar)
        {
            await Shell.Current.GoToAsync(".."); // Navega a la p√°gina anterior
        }
    }
}
```

Explicaci√≥n:

* `BackCommand`: Se enlaza al bot√≥n "Atr√°s" en el XAML y ejecuta `VolverAtras()`.
* `VolverAtras()`:
  * Muestra un cuadro de di√°logo de confirmaci√≥n antes de navegar atr√°s.
  * Si el usuario confirma, usa `Shell.Current.GoToAsync("..")` para regresar a la p√°gina anterior.


## Uso del Search Handler en .NET MAUI con Shell

Vamos a desglosar y explicar de manera sencilla c√≥mo funciona el SearchHandler en .NET MAUI, c√≥mo personalizar la b√∫squeda y c√≥mo redirigir a una vista de b√∫squeda. Tambi√©n veremos c√≥mo filtrar resultados y personalizar la apariencia de los elementos de b√∫squeda.

1. **¬øQu√© es un SearchHandler?**

El `SearchHandler` es una herramienta en .NET MAUI que te permite agregar una funcionalidad de b√∫squeda en tu aplicaci√≥n. Puedes usarlo para buscar elementos en una lista, filtrar resultados y navegar a una vista espec√≠fica cuando el usuario selecciona un resultado.

### Crear un SeachHandler

Primero, debemos crear una clase que herede de `SearchHandler`. Esta clase se encargar√° de obtener los datos y aplicar el filtro de b√∫squeda.

**Ejemplo de un `SearchHandler` para Ofertas (`OffersSearchHandler`):**

```csharp
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.Maui.Controls;

public class OffersSearchHandler : SearchHandler
{
    public List<Offer> Suggestions { get; set; } = new List<Offer>();

    public OffersSearchHandler() 
    {
        var service = Application.Current.MainPage
            .Handler
            .MauiContext
            .Services.GetService<OffersService>();
        
        Suggestions = service.Offers;  // Cargamos las ofertas desde un servicio
        ItemsSource = Suggestions;     // Mostramos todos los resultados al inicio
    }

    // Filtra los resultados en tiempo real cuando el usuario escribe
    protected override void OnQueryChanged(string oldValue, string newValue)
    {
        if (string.IsNullOrEmpty(newValue)) 
        {
            ItemsSource = Suggestions; // Muestra todos si no hay b√∫squeda activa
        } 
        else 
        {
            ItemsSource = Suggestions
                .Where(offer => offer.OfferName.ToLower().Contains(newValue.ToLower()))
                .ToList();
        }
    }

    // Maneja la selecci√≥n de un elemento en la lista de resultados
    protected override async void OnItemSelected(object item)
    {
        if (item is Offer selectedOffer)
        {
            var navigationParameter = new Dictionary<string, object>
            {
                { "offer", selectedOffer }
            };

            await Shell.Current.GoToAsync($"offersView", navigationParameter);
        }
    }
}
```
Explicaci√≥n:

* `Suggestions` almacena todas las ofertas disponibles.
* `OnQueryChanged(...)` actualiza los resultados conforme el usuario escribe.
* `OnItemSelected(...)` redirige al usuario a la p√°gina de detalles de la oferta seleccionada.

### Agregar `SearchHandler`, a una `ContentPage`

Despu√©s de definir el `SearchHandler`, lo integramos en nuestra `ContentPage` dentro del `Shell`:

```xml
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:search="clr-namespace:DevsPark.Search">
    
    <Shell.SearchHandler>
        <search:OffersSearchHandler DisplayMemberName="OfferName"
                                    Placeholder="Buscar ofertas"
                                    ShowsResults="True"/>
    </Shell.SearchHandler>

</ContentPage>
```

* `DisplayMemberName="OfferName"` ‚Üí Define qu√© propiedad del objeto mostrar en la lista de resultados.
* `Placeholder="Buscar ofertas"` ‚Üí Texto que aparece en la caja de b√∫squeda.
* `ShowsResults="True"` ‚Üí Habilita la visualizaci√≥n autom√°tica de resultados.

### Registrar la ruta en AppShell.xml

Para que la b√∫squeda funcione correctamente, debemos registrar la vista de b√∫squeda en el `AppShell.xaml` **sin que aparezca en el men√∫ lateral** `(FlyoutItemIsVisible="False")`:

```xml
<ShellContent
    Title="Buscar"
    ContentTemplate="{DataTemplate pages:SearchView}"
    FlyoutItemIsVisible="False"/>
```

### Agregar un Command para abrir la b√∫squeda

Podemos agregar un bot√≥n o Label que active la b√∫squeda:

```xml
<Label Text="Buscar ofertas"
       TextColor="Blue">
    <Label.GestureRecognizers>
        <TapGestureRecognizer Command="{Binding SearchCommand}" />
    </Label.GestureRecognizers>
</Label>
```
En el ViewModel, definimos el Command:
```csharp
[RelayCommand]
public async Task Search()
{
    await Shell.Current.GoToAsync("search");
}
```
As√≠, al tocar el `Label`, navegamos a la p√°gina de b√∫squeda.

### Personalizar la apariencia de los resultados

Podemos definir un `ItemTemplate` para cambiar el dise√±o de los resultados en la lista:
```xml
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:search="clr-namespace:DevsPark.Search">

    <Shell.SearchHandler>
        <search:OffersSearchHandler DisplayMemberName="OfferName"
                                    Placeholder="Buscar ofertas"
                                    ShowsResults="True">

            <search:OffersSearchHandler.ItemTemplate>
                <DataTemplate>
                    <Grid ColumnDefinitions=".3*, .7*" RowDefinitions="*,5">
                        <!-- Imagen de la oferta -->
                        <Image Source="{Binding Image}" />

                        <!-- Nombre de la oferta -->
                        <Label Grid.Column="1"
                               FontSize="14"
                               HorizontalOptions="Center"
                               Text="{Binding OfferName}"
                               VerticalOptions="Center" />

                        <!-- Separador -->
                        <Rectangle Grid.Row="1"
                                   Grid.ColumnSpan="2"
                                   Fill="#E0E0E0"/>
                    </Grid>
                </DataTemplate>
            </search:OffersSearchHandler.ItemTemplate>

        </search:OffersSearchHandler>
    </Shell.SearchHandler>

</ContentPage>
```
Aqu√≠ logramos:
* ItemTemplate: Define c√≥mo se muestra cada elemento en los resultados de b√∫squeda.
* Mostrar una imagen (Image).
* Mostrar el nombre de la oferta (Label).
* Agregar una l√≠nea separadora (Rectangle).

### Configuraciones adicionales para SearchHandler en .NET MAUI

El SearchHandler en .NET MAUI ofrece varias opciones de configuraci√≥n que nos permiten personalizar el comportamiento y la apariencia del buscador. A continuaci√≥n, te explico las propiedades m√°s importantes y sus posibles valores.

1. SearchBoxVisibility

Define c√≥mo se muestra la caja de b√∫squeda en la p√°gina.

* Valores disponibles:
  * Auto: Se muestra autom√°ticamente en plataformas compatibles.
  * Expanded: La caja de b√∫squeda siempre est√° visible.
  * Hidden: La caja de b√∫squeda est√° oculta y no se muestra en la interfaz.
  * Collapsible (valor por defecto): La caja de b√∫squeda aparece cuando el usuario la necesita y se oculta cuando no se usa.
**Ejemplo en XAML:**
```xml
<SearchHandler SearchBoxVisibility="Expanded"/>
```

2. Keyboard

Permite definir el tipo de teclado que se mostrar√° cuando el usuario escriba en la caja de b√∫squeda.

* Valores disponibles:
  * **Chat:** Teclado con √≠conos y funciones para chats.
  * **Default:** Teclado normal del sistema.
  * **Email:** Teclado optimizado para ingresar correos electr√≥nicos.
  * **Numeric:** Solo n√∫meros.
  * **Plain:** Teclado sin predicciones ni correcciones.
  * **Telephone:** Teclado optimizado para ingresar n√∫meros de tel√©fono.
  * **Text:** Teclado est√°ndar para texto.
  * **Url:** Teclado optimizado para ingresar URLs.
```xml
<SearchHandler Keyboard="Email"/>
```

3. Placeholder

Permite definir el texto que aparece dentro de la caja de b√∫squeda antes de que el usuario escriba.

**Ejemplo en XAML:**
```xml
<SearchHandler Placeholder="Buscar ofertas..."/>
```

4. ShowsResults

Determina si los resultados se muestran autom√°ticamente mientras el usuario escribe.

* Valores disponibles:
  * True: Muestra los resultados de b√∫squeda en tiempo real.
  * False: No muestra los resultados autom√°ticamente
**Ejemplo en XAML:**
```xml
<SearchHandler ShowsResults="True"/>
```

5. DisplayMemberName


Indica qu√© propiedad del objeto se mostrar√° en la lista de resultados.

**Ejemplo en XAML:**
```xml
<SearchHandler DisplayMemberName="OfferName"/>
```

6. Query

Esta propiedad almacena el texto ingresado en la b√∫squeda. Se puede modificar desde el c√≥digo para establecer un valor predeterminado.

**Ejemplo en C#:**

```chsarp
mySearchHandler.Query = "Ofertas de hoy";
```


1. IsSearchEnabled

Habilita o deshabilita la b√∫squeda.

* Valores disponibles:
  * True (por defecto): La b√∫squeda est√° habilitada.
  * False: La b√∫squeda est√° deshabilitada.
**Ejemplo en XAML:**

```xml
<SearchHandler IsSearchEnabled="False"/>
```

**Ejemplo completo con todas las configuraciones**
```xml
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:search="clr-namespace:DevsPark.Search">

    <Shell.SearchHandler>
        <search:OffersSearchHandler DisplayMemberName="OfferName"
                                    Placeholder="Buscar ofertas..."
                                    ShowsResults="True"
                                    SearchBoxVisibility="Expanded"
                                    Keyboard="Text"
                                    IsSearchEnabled="True"/>
    </Shell.SearchHandler>

</ContentPage>
```
 